<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Ticker App</title>
  <style>
    /* Reset and Base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; overflow: hidden; }

    /* Header */
    header {
      display: flex;
      background: #333;
      padding: 10px;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 10;
    }
    header button {
      margin-right: 10px;
      color: #fff;
      background: #555;
      border: none;
      padding: 10px;
      cursor: pointer;
      border-radius: 4px;
    }
    header button.active { background: #007acc; }
    :fullscreen header { display: none !important; }

    /* Sections */
    section { display: none; height: 100vh; }
    section.active { display: block; }

    /* Admin Page Styling */
    #sectionAdmin {
      padding: 80px 20px 20px;
      overflow-y: auto;
    }
    .control-group { margin-bottom: 15px; }
    .control-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    .control-group input { width: 100%; padding: 8px; }
    #settingsButtons { margin-bottom: 20px; }
    #settingsButtons button, #settingsButtons input { margin-right: 10px; }
    form { max-width: 500px; margin-bottom: 20px; }
    form input { display: block; width: 100%; margin-bottom: 10px; padding: 8px; }
    form button { padding: 10px 15px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    table th, table td { border: 1px solid #ccc; padding: 8px; text-align: left; }

    /* Ticker Styling */
    #sectionTicker { position: relative; }
    .ticker-wrapper {
      overflow: hidden;
      background: #fff;
      display: flex;
      align-items: center;
      --item-height: 150px;
      --name-font: 28.8px;
      --price-font: 22.4px;
      height: var(--section-height, 100vh);
    }
    .ticker-content-container {
      display: inline-flex;
      animation: scroll linear infinite;
    }
    .ticker-item {
      display: inline-flex;
      align-items: center;
      margin-right: 50px;
      white-space: nowrap;
    }
    .ticker-item img {
      height: var(--item-height);
      width: auto;
      object-fit: contain;
      margin-right: 20px;
    }
    .ticker-item-details { display: flex; flex-direction: column; }
    .ticker-item-name {
      font-size: var(--name-font);
      font-weight: bold;
      margin-bottom: 10px;
      color: #000;
    }
    .ticker-prices { display: flex; }
    .ticker-prices .old-price,
    .ticker-prices .new-price {
      flex: 1;
      font-size: var(--price-font);
      text-align: center;
      padding: 0 10px;
    }
    .ticker-prices .old-price {
      color: #000;
      border-right: 1px solid #000;
      text-decoration: line-through;
    }
    .ticker-prices .new-price { color: #e60000; }

    @keyframes scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
  </style>
</head>
<body>
  <header>
    <button id="btnAdmin" class="active">Admin</button>
    <button id="btnTicker">Ticker</button>
    <button id="fullscreenBtn">Full Screen</button>
  </header>

  <section id="sectionAdmin" class="active">
    <h2>Admin Page</h2>
    <div id="settingsButtons">
      <button id="exportBtn">Export Settings</button>
      <button id="importBtn">Import Settings</button>
      <button id="saveSettingsBtn">Save Settings to GitHub</button>
      <button id="saveProductsBtn">Save Products to GitHub</button>
      <input type="text" id="ghToken" placeholder="GitHub Token" style="width:200px;">
      <button id="exportProdBtn">Export Products</button>
      <button id="importProdBtn">Import Products</button>
      <input type="file" id="importInput" accept="application/json" style="display:none;">
      <input type="file" id="importProdInput" accept="application/json" style="display:none;">
    </div>
    <div class="control-group">
      <label for="speedInput">Scroll speed (seconds per 100px):</label>
      <input type="number" id="speedInput" min="0.1" max="10" step="0.1">
    </div>
    <div class="control-group">
      <label for="heightInput">Ticker section height (px):</label>
      <input type="number" id="heightInput" min="100" max="2000" step="10">
    </div>
    <div class="control-group">
      <label for="itemHeightInput">Ticker item height (px):</label>
      <input type="number" id="itemHeightInput" min="50" max="500" step="10">
    </div>
    <div class="control-group">
      <label for="nameFontInput">Product name font size (px):</label>
      <input type="number" id="nameFontInput" min="10" max="100" step="1">
    </div>
    <div class="control-group">
      <label for="priceFontInput">Price font size (px):</label>
      <input type="number" id="priceFontInput" min="10" max="100" step="1">
    </div>
    <form id="productForm">
      <input type="text" id="name" placeholder="Product Name" required>
      <input type="text" id="oldPrice" placeholder="Old Price" required>
      <input type="text" id="newPrice" placeholder="New Price" required>
      <input type="url" id="imageUrl" placeholder="Image URL" required>
      <button type="submit">Save Product</button>
    </form>
    <table>
      <thead>
        <tr><th>Image</th><th>Name</th><th>Old Price</th><th>New Price</th><th>Actions</th></tr>
      </thead>
      <tbody id="productList"></tbody>
    </table>
  </section>

  <section id="sectionTicker">
    <div class="ticker-wrapper" id="tickerWrapper">
      <div class="ticker-content-container" id="tickerContent"></div>
    </div>
  </section>

  <script>
    // Load settings.json and products.json, then initialize
    async function init() {
      // Fetch settings.json
      let fetchedSettings = null;
      try {
        const resp = await fetch('settings.json');
        if (resp.ok) fetchedSettings = await resp.json();
      } catch {}
      if (fetchedSettings) {
        speed = fetchedSettings.speed ?? speed;
        heightPx = fetchedSettings.heightPx ?? heightPx;
        itemHeight = fetchedSettings.itemHeight ?? itemHeight;
        nameFont = fetchedSettings.nameFont ?? nameFont;
        priceFont = fetchedSettings.priceFont ?? priceFont;
      }

      // Fetch products.json
      try {
        const resp2 = await fetch('products.json');
        if (resp2.ok) products = await resp2.json();
      } catch {}

      // Update inputs with fetched or local values
      speedInput.value = speed;
      heightInput.value = heightPx;
      itemHeightInput.value = itemHeight;
      nameFontInput.value = nameFont;
      priceFontInput.value = priceFont;

      applyAll();
      renderAdmin();
      renderTicker();
    }

    // Defaults from localStorage (used if fetch fails)
    let products = JSON.parse(localStorage.getItem('products') || '[]');
    let speed = parseFloat(localStorage.getItem('tickerSpeed')) || 0.5;
    let heightPx = parseInt(localStorage.getItem('tickerHeight')) || window.innerHeight;
    let itemHeight = parseInt(localStorage.getItem('tickerItemHeight')) || 150;
    let nameFont = parseFloat(localStorage.getItem('tickerNameFont')) || 28.8;
    let priceFont = parseFloat(localStorage.getItem('tickerPriceFont')) || 22.4;

    // DOM elements
    const form = document.getElementById('productForm');
    const productList = document.getElementById('productList');
    const tickerContent = document.getElementById('tickerContent');
    const tickerWrapper = document.getElementById('tickerWrapper');
    const speedInput = document.getElementById('speedInput');
    const heightInput = document.getElementById('heightInput');
    const itemHeightInput = document.getElementById('itemHeightInput');
    const nameFontInput = document.getElementById('nameFontInput');
    const priceFontInput = document.getElementById('priceFontInput');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const saveSettingsBtn = document.getElementById('saveSettingsBtn');
    const saveProductsBtn = document.getElementById('saveProductsBtn');
    const exportProdBtn = document.getElementById('exportProdBtn');
    const importProdBtn = document.getElementById('importProdBtn');
    const importInput = document.getElementById('importInput');
    const importProdInput = document.getElementById('importProdInput');
    const btnAdmin = document.getElementById('btnAdmin');
    const btnTicker = document.getElementById('btnTicker');
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    const ghTokenInput = document.getElementById('ghToken');
    let editIndex = -1;

    // Event listeners
    speedInput.addEventListener('change', onSpeedChange);
    heightInput.addEventListener('change', onHeightChange);
    itemHeightInput.addEventListener('change', onItemHeightChange);
    nameFontInput.addEventListener('change', onNameFontChange);
    priceFontInput.addEventListener('change', onPriceFontChange);
    form.addEventListener('submit', onFormSubmit);
    exportBtn.addEventListener('click', onExportSettings);
    importBtn.addEventListener('click', () => importInput.click());
    importInput.addEventListener('change', onImportSettingsFile);
    saveSettingsBtn.addEventListener('click', saveSettingsToGitHub);
    saveProductsBtn.addEventListener('click', saveProductsToGitHub);
    exportProdBtn.addEventListener('click', onExportProducts);
    importProdBtn.addEventListener('click', () => importProdInput.click());
    importProdInput.addEventListener('change', onImportProductsFile);
    btnAdmin.addEventListener('click', () => switchSection('Admin'));
    btnTicker.addEventListener('click', () => switchSection('Ticker'));
    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    });
    document.addEventListener('fullscreenchange', () => {
      fullscreenBtn.textContent = document.fullscreenElement ? 'Exit Full Screen' : 'Full Screen';
    });

    // Other handlers and functions unchanged...

    // Start on load
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
